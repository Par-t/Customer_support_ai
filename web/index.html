<!doctype html>
<html>
<head>
  <meta charset="utf-8">
  <title>Support Copilot — Minimal</title>
  <style>
    body { font-family: Arial, sans-serif; max-width: 900px; margin: 30px auto; }
    .container { display: grid; gap: 12px; }
    textarea { width: 100%; height: 80px; }
    button { padding: 8px 12px; }
    .answer { background:#f6f8fa; padding:12px; border-radius:6px; }
    .source { font-size: .9em; color: #555; margin-top:6px; }
  </style>
</head>
<body>
  <div class="container">
    <h1>Support Copilot — Minimal Demo</h1>
    <label>Tenant:
      <select id="tenant">
        <option value="demo">demo</option>
      </select>
    </label>

    <label>Ask a question</label>
    <textarea id="question" placeholder="e.g. How do I reset the device?"></textarea>
    <div>
      <button id="askBtn">Ask</button>
      <button id="reloadDocsBtn">Reload sample docs</button>
    </div>

    <h3>Answer</h3>
    <div id="answerBox" class="answer">No answer yet.</div>
    <div id="sources"></div>

    <hr>
    <h4>Ingest a file (optional)</h4>
    <input type="file" id="fileInput" />
    <button id="uploadBtn">Upload & Ingest</button>
    <div id="uploadStatus"></div>
  </div>

  <script>
    const askBtn = document.getElementById('askBtn');
    const reloadDocsBtn = document.getElementById('reloadDocsBtn');
    const uploadBtn = document.getElementById('uploadBtn');

    async function query(question) {
      const tenant = document.getElementById('tenant').value;
      const resp = await fetch('/query', {
        method: 'POST',
        headers: {'Content-Type':'application/json'},
        body: JSON.stringify({tenant, question})
      });
      return resp.json();
    }

    askBtn.onclick = async () => {
      const q = document.getElementById('question').value.trim();
      if (!q) return alert('Enter question');
      document.getElementById('answerBox').innerText = 'Thinking...';
      const r = await query(q);
      document.getElementById('answerBox').innerText = r.answer || '(no answer)';
      const sources = document.getElementById('sources');
      sources.innerHTML = '';
      if (r.sources && r.sources.length) {
        r.sources.forEach(s => {
          const d = document.createElement('div');
          d.className = 'source';
          d.innerHTML = `<strong>${s.title}</strong> — snippet: ${s.snippet}`;
          sources.appendChild(d);
        });
      }
    };

    reloadDocsBtn.onclick = async () => {
      const resp = await fetch('/ingest_sample');
      const t = await resp.text();
      alert(t);
    };

    uploadBtn.onclick = async () => {
      const fileInput = document.getElementById('fileInput');
      if (!fileInput.files[0]) return alert('Select file first');
      const form = new FormData();
      form.append('tenant', 'demo');
      form.append('file', fileInput.files[0]);
      const resp = await fetch('/ingest', {method:'POST', body: form});
      const data = await resp.json();
      document.getElementById('uploadStatus').innerText = JSON.stringify(data);
    };
  </script>
</body>
</html>
